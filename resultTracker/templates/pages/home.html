{% extends '../components/base.html' %}


{% block header_title %}
Results Tracker Home
{% endblock header_title %}


{% block content %}
<div class="col-4 mb-4">
    <form method="POST" action="/model_form" class="form">
        <h2>Add CM Details</h2>
        <input type="hidden" value='/' name="next" />
        <label for="cmVerRev">CM Model Ver Rev:</label>
        <input id="cmVerRev" type="text" required="required" name="cmVerRev" placeholder="VxxRxx" />
        <label for="baseVerRev">Base Model Ver Rev:</label>
        <input id="baseVerRev" type="text" name="baseVerRev" placeholder="VxxRxx" />
        <label for="cmModeldescription">Add CM Desciption</label>
        <textarea id="cmModeldescription" name="cmModeldescription"></textarea>
        <button class="btn btn-primary" type="submit">submit</button>
    </form>

</div>

<table class="table">
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">Cm Model</th>
            <th scope="col">Model Description</th>
            <th scope="col">Based Model</th>
            <th scope="col">Results</th>
        </tr>
    </thead>
    <tbody id="Models">
        <tr>
            <th scope="row"></th>
            <td></td>
            <td style="font-size:100px; font-weight: 900; color:lightgray"><i>No Data.. </i></td>
            <td></td>
        </tr>
    </tbody>
</table>

<script>
    const modelElemID = document.getElementById("Models")
    // CHANGE TO A FETCH!!
    const xhr = new XMLHttpRequest()
    const method = "GET"
    const url = "/models"
    const responseType = "json"

    xhr.responseType = responseType;
    xhr.open(method, url)
    xhr.onload = function () {
        let serverResp = xhr.response
        let listedItems = (serverResp.response)
        let htmlModelList = ""

        function isStringEmpty(listItem) {
            // 
            return checkListItem = listItem ? listItem :
                `<span style = "color:lightgray" > No Data...</span>`
        }

        for (var i = 0; i < listedItems.length; i++) {

            let currentRow = `
                    <tr id='result_'+${listedItems[i].id}''>
                        <th scope="row">${listedItems[i].id}</th>
                        <td>${listedItems[i].cm_model_name}</td>
                        <td><i>${isStringEmpty(listedItems[i].cm_model_description)}</i></td>
                        <td>${isStringEmpty(listedItems[i].base_model_name)}</td>
                        <td> <a href="/model_detail/${listedItems[i].id}">Results</a> </td>
                    </tr>
            `
            htmlModelList += currentRow
        }
        modelElemID.innerHTML = htmlModelList
    }
    xhr.send()
</script>
{% endblock content %}